module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},63021,(e,t,a)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},98043,e=>{"use strict";var t=e.i(63021);let a=globalThis.prisma??new t.PrismaClient({log:["error"]});e.s(["prisma",0,a])},91208,e=>{"use strict";let t={FRIDGE:{min:2,max:8},FREEZER:{min:-25,max:-18}};function a(e){let{temperature:a,humidity:r,deviceType:i,lastSeenAt:n,tempMin:s=t[i].min,tempMax:o=t[i].max,humidityMin:l=30,humidityMax:d=70,recentReadings:u=[]}=e,c=[],p=[],m="low";if(n){let e=(Date.now()-n.getTime())/6e4;if(e>30)return{status:"OFFLINE",reasons:[`No data received for ${Math.round(e)} minutes`],severity:"high",recommendations:["Check device connectivity","Verify GSM signal","Inspect power supply"]}}if(a>o?(c.push(`Temperature ${a}\xb0C exceeds maximum ${o}\xb0C`),m="critical",p.push("Check door seal","Verify compressor operation","Reduce ambient temperature")):a<s&&(c.push(`Temperature ${a}\xb0C below minimum ${s}\xb0C`),m="critical",p.push("Check thermostat settings","Verify temperature sensor")),a>=o-1&&a<=o?(c.push(`Temperature ${a}\xb0C approaching upper limit`),"critical"!==m&&(m="medium")):a<=s+1&&a>=s&&(c.push(`Temperature ${a}\xb0C approaching lower limit`),"critical"!==m&&(m="medium")),r>d?(c.push(`Humidity ${r}% exceeds maximum ${d}%`),"critical"!==m&&(m="medium"),p.push("Check door gasket","Reduce frequency of door opening")):r<l&&(c.push(`Humidity ${r}% below minimum ${l}%`),"critical"!==m&&(m="medium")),u.length>=2){let e=[...u].sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime());for(let t=0;t<e.length-1;t++){let a=e[t],r=e[t+1],i=(a.timestamp.getTime()-r.timestamp.getTime())/6e4;if(i<=5){let e=Math.abs(a.temperature-r.temperature);if(e>5){c.push(`Rapid temperature change detected: ${e.toFixed(1)}\xb0C in ${i.toFixed(0)} minutes`),m="high",p.push("Check if door was left open","Inspect for power fluctuations");break}}}}return{status:0===c.length?"HEALTHY":"critical"===m?"NOT_HEALTHY":"high"===m||"medium"===m?"WARNING":"HEALTHY",reasons:c,severity:m,recommendations:p}}function r(e,t,a,i,n=100){if(null===e||null===t)return!1;let s=e*Math.PI/180,o=a*Math.PI/180,l=(a-e)*Math.PI/180,d=(i-t)*Math.PI/180,u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s)*Math.cos(o)*Math.sin(d/2)*Math.sin(d/2);return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3>n}function i(e){return 0===e.length?100:Math.round(e.filter(e=>"HEALTHY"===e.healthStatus).length/e.length*100)}e.s(["calculateComplianceRate",()=>i,"calculateHealthStatus",()=>a,"hasDeviceMoved",()=>r])},26217,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),n=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),h=e.i(26937),x=e.i(10372),v=e.i(93695);e.i(52474);var g=e.i(220),f=e.i(89171),R=e.i(98043),y=e.i(91208);async function E(e){try{let t=e.headers.get("X-API-Key");if(!t)return f.NextResponse.json({success:!1,error:"Missing API key"},{status:401});let a=await e.json();if(!a.device_id||void 0===a.temp||void 0===a.humidity)return f.NextResponse.json({success:!1,error:"Missing required fields: device_id, temp, humidity"},{status:400});let r=await R.prisma.device.findFirst({where:{deviceId:a.device_id,apiKey:t},include:{readings:{orderBy:{serverTimestamp:"desc"},take:50}}});if(!r)return f.NextResponse.json({success:!1,error:"Invalid device ID or API key"},{status:403});let i=r.readings.map(e=>({temperature:e.temperature,timestamp:e.serverTimestamp})),n=(0,y.calculateHealthStatus)({temperature:a.temp,humidity:a.humidity,deviceType:r.type,lastSeenAt:r.lastSeenAt,tempMin:r.tempMin,tempMax:r.tempMax,humidityMin:r.humidityMin,humidityMax:r.humidityMax,recentReadings:i}),s=n.status,o=r.needsManualReset;"NOT_HEALTHY"===n.status?o=!0:r.needsManualReset&&"NOT_HEALTHY"===r.healthStatus&&(s="NOT_HEALTHY");let l=await R.prisma.deviceReading.create({data:{deviceId:r.id,temperature:a.temp,humidity:a.humidity,latitude:a.lat,longitude:a.lon,gsmSignal:a.gsm_signal,batteryLevel:a.battery_level,healthStatus:s,deviceTimestamp:a.timestamp?new Date(a.timestamp):new Date}});if(await R.prisma.device.update({where:{id:r.id},data:{healthStatus:s,needsManualReset:o,isOnline:!0,lastSeenAt:new Date,lastTempValue:a.temp,lastHumidityValue:a.humidity,lastLatitude:a.lat,lastLongitude:a.lon}}),a.lat&&a.lon&&(0,y.hasDeviceMoved)(r.lastLatitude,r.lastLongitude,a.lat,a.lon)&&(await T(r.id,"GPS_MOVED","HIGH","Device Location Changed","Device has moved from its registered location"),await R.prisma.deviceEvent.create({data:{deviceId:r.id,eventType:"GPS_LOCATION_CHANGED",description:`Location changed from (${r.lastLatitude}, ${r.lastLongitude}) to (${a.lat}, ${a.lon})`}})),"NOT_HEALTHY"===n.status)for(let e of n.reasons){let t="TEMPERATURE_HIGH";e.includes("exceeds maximum")?t="TEMPERATURE_HIGH":e.includes("below minimum")?t="TEMPERATURE_LOW":e.includes("Humidity")&&e.includes("exceeds")?t="HUMIDITY_HIGH":e.includes("Humidity")&&e.includes("below")&&(t="HUMIDITY_LOW"),await T(r.id,t,"CRITICAL","Temperature/Humidity Alert",e,a.temp,t.includes("TEMP")?"TEMPERATURE_HIGH"===t?r.tempMax:r.tempMin:"HUMIDITY_HIGH"===t?r.humidityMax:r.humidityMin)}return r.readings.length%10==0&&r.readings.length,f.NextResponse.json({success:!0,status:s,icon:function(e){switch(e){case"HEALTHY":return"âœ…";case"WARNING":return"âš ï¸";case"NOT_HEALTHY":return"âŒ";case"OFFLINE":return"ðŸ“¡";default:return"â“"}}(s),message:n.reasons[0]||"OK",reading_id:l.id})}catch(e){return console.error("Telemetry API Error:",e),f.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function T(e,t,a,r,i,n,s){await R.prisma.alert.findFirst({where:{deviceId:e,alertType:t,status:"ACTIVE"}})||await R.prisma.alert.create({data:{deviceId:e,alertType:t,severity:a,title:r,message:i,triggerValue:n,thresholdValue:s}})}e.s(["POST",()=>E,"dynamic",0,"force-dynamic"],17033);var w=e.i(17033);let H=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/devices/telemetry/route",pathname:"/api/devices/telemetry",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/devices/telemetry/route.ts",nextConfigOutput:"standalone",userland:w}),{workAsyncStorage:A,workUnitAsyncStorage:M,serverHooks:C}=H;function I(){return(0,r.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:M})}async function b(e,t,r){H.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/devices/telemetry/route";f=f.replace(/\/index$/,"")||"/";let R=await H.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:y,params:E,nextConfig:T,parsedUrl:w,isDraftMode:A,prerenderManifest:M,routerServerContext:C,isOnDemandRevalidate:I,revalidateOnlyGenerated:b,resolvedPathname:N,clientReferenceManifest:_,serverActionsManifest:P}=R,O=(0,o.normalizeAppPath)(f),S=!!(M.dynamicRoutes[O]||M.routes[N]),k=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,w,!1):t.end("This page could not be found"),null);if(S&&!A){let e=!!M.routes[N],t=M.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await k();throw new v.NoFallbackError}}let L=null;!S||H.isDev||A||(L="/index"===(L=N)?"/":L);let D=!0===H.isDev||!S,$=S&&!D;P&&_&&(0,s.setManifestsSingleton)({page:f,clientReferenceManifest:_,serverActionsManifest:P});let q=e.method||"GET",j=(0,n.getTracer)(),U=j.getActiveScopeSpan(),F={params:E,prerenderManifest:M,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,i)=>H.onRequestError(e,t,r,i,C)},sharedContext:{buildId:y}},G=new l.NodeNextRequest(e),Y=new l.NodeNextResponse(t),K=d.NextRequestAdapter.fromNodeNextRequest(G,(0,d.signalFromNodeResponse)(t));try{let s=async e=>H.handle(K,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=j.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${f}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let d=async({previousCacheEntry:a})=>{try{if(!o&&I&&b&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=F.renderOpts.collectedTags;if(!S)return await (0,p.sendResponse)(G,Y,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[x.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await H.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:I})},!1,C),t}},u=await H.handleResponse({req:e,nextConfig:T,cacheKey:L,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:M,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:b,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:o});if(!S)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",I?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&S||v.delete(x.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(G,Y,new Response(u.value.body,{headers:v,status:u.value.status||200})),null};U?await l(U):await j.withPropagatedContext(e.headers,()=>j.trace(u.BaseServerSpan.handleRequest,{spanName:`${q} ${f}`,kind:n.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof v.NoFallbackError||await H.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:I})},!1,C),S)throw t;return await (0,p.sendResponse)(G,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>I,"routeModule",()=>H,"serverHooks",()=>C,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>M],26217)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__5ca315f9._.js.map